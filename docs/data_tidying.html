<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.514">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tidy Data &amp; Visualisation in R - Data tidying</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data_visualisation.html" rel="next">
<link href="./raw_data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Tidy Data &amp; Visualisation in R</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html">Overview</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./requirements.html">Requirements</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./trainers.html">Trainers</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Data tidying</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">Setup</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raw_data.html" class="sidebar-item-text sidebar-link">Raw data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_tidying.html" class="sidebar-item-text sidebar-link active">Data tidying</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_visualisation.html" class="sidebar-item-text sidebar-link">Data visualisation</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#add-missing-columns" id="toc-add-missing-columns" class="nav-link" data-scroll-target="#add-missing-columns">Add missing columns</a>
  <ul class="collapse">
  <li><a href="#exercise-2.1" id="toc-exercise-2.1" class="nav-link" data-scroll-target="#exercise-2.1">Exercise 2.1</a></li>
  </ul></li>
  <li><a href="#make-variable-column-names-consistent-across-data-sets" id="toc-make-variable-column-names-consistent-across-data-sets" class="nav-link" data-scroll-target="#make-variable-column-names-consistent-across-data-sets">Make variable (column) names consistent across data sets</a>
  <ul class="collapse">
  <li><a href="#exercise-2.2" id="toc-exercise-2.2" class="nav-link" data-scroll-target="#exercise-2.2">Exercise 2.2</a></li>
  </ul></li>
  <li><a href="#combining-the-crabs-data-sets-into-one" id="toc-combining-the-crabs-data-sets-into-one" class="nav-link" data-scroll-target="#combining-the-crabs-data-sets-into-one">Combining the crabs data sets into one</a>
  <ul class="collapse">
  <li><a href="#exercise-2.3" id="toc-exercise-2.3" class="nav-link" data-scroll-target="#exercise-2.3">Exercise 2.3</a></li>
  </ul></li>
  <li><a href="#organising-variables-columns" id="toc-organising-variables-columns" class="nav-link" data-scroll-target="#organising-variables-columns">Organising variables (columns)</a>
  <ul class="collapse">
  <li><a href="#exercise-2.4" id="toc-exercise-2.4" class="nav-link" data-scroll-target="#exercise-2.4">Exercise 2.4</a></li>
  </ul></li>
  <li><a href="#filling-in-fake-missing-values" id="toc-filling-in-fake-missing-values" class="nav-link" data-scroll-target="#filling-in-fake-missing-values">Filling in fake missing values</a>
  <ul class="collapse">
  <li><a href="#exercise-2.5" id="toc-exercise-2.5" class="nav-link" data-scroll-target="#exercise-2.5">Exercise 2.5</a></li>
  </ul></li>
  <li><a href="#recode-na-aliases" id="toc-recode-na-aliases" class="nav-link" data-scroll-target="#recode-na-aliases">Recode <code>NA</code> aliases</a>
  <ul class="collapse">
  <li><a href="#exercise-2.6" id="toc-exercise-2.6" class="nav-link" data-scroll-target="#exercise-2.6">Exercise 2.6</a></li>
  </ul></li>
  <li><a href="#general-recoding-of-values" id="toc-general-recoding-of-values" class="nav-link" data-scroll-target="#general-recoding-of-values">General recoding of values</a>
  <ul class="collapse">
  <li><a href="#exercise-2.7" id="toc-exercise-2.7" class="nav-link" data-scroll-target="#exercise-2.7">Exercise 2.7</a></li>
  </ul></li>
  <li><a href="#fix-scale-of-quantitative-variables" id="toc-fix-scale-of-quantitative-variables" class="nav-link" data-scroll-target="#fix-scale-of-quantitative-variables">Fix scale of quantitative variables</a>
  <ul class="collapse">
  <li><a href="#exercise-2.8" id="toc-exercise-2.8" class="nav-link" data-scroll-target="#exercise-2.8">Exercise 2.8</a></li>
  </ul></li>
  <li><a href="#ensure-appropriate-variable-types" id="toc-ensure-appropriate-variable-types" class="nav-link" data-scroll-target="#ensure-appropriate-variable-types">Ensure appropriate variable types</a>
  <ul class="collapse">
  <li><a href="#exercise-2.9" id="toc-exercise-2.9" class="nav-link" data-scroll-target="#exercise-2.9">Exercise 2.9</a></li>
  </ul></li>
  <li><a href="#column-names-are-values-not-variable-names" id="toc-column-names-are-values-not-variable-names" class="nav-link" data-scroll-target="#column-names-are-values-not-variable-names">Column names are values, not variable names</a>
  <ul class="collapse">
  <li><a href="#exercise-2.10" id="toc-exercise-2.10" class="nav-link" data-scroll-target="#exercise-2.10">Exercise 2.10</a></li>
  <li><a href="#exercise-2.11" id="toc-exercise-2.11" class="nav-link" data-scroll-target="#exercise-2.11">Exercise 2.11</a></li>
  </ul></li>
  <li><a href="#multiple-observational-unit-types-in-one-table" id="toc-multiple-observational-unit-types-in-one-table" class="nav-link" data-scroll-target="#multiple-observational-unit-types-in-one-table">Multiple observational unit types in one table</a>
  <ul class="collapse">
  <li><a href="#exercise-2.12" id="toc-exercise-2.12" class="nav-link" data-scroll-target="#exercise-2.12">Exercise 2.12</a></li>
  </ul></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up">Wrapping up</a>
  <ul class="collapse">
  <li><a href="#exercise-2.13" id="toc-exercise-2.13" class="nav-link" data-scroll-target="#exercise-2.13">Exercise 2.13</a></li>
  </ul></li>
  <li><a href="#data-tidying-script" id="toc-data-tidying-script" class="nav-link" data-scroll-target="#data-tidying-script">Data tidying script</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Data tidying</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>We will now embark on a series of data transformations to convert our nine data sets into only two tidy data sets:</p>
<ul>
<li><code>crabs</code></li>
<li><code>quadrats</code></li>
</ul>
<p>So bear these two data sets in mind as these are our end goal for the Data Tidying workflow of today.</p>
<p>From the previous section Raw Data you should have generated these nine data sets that are now our starting point:</p>
<ul>
<li>Ria Formosa
<ul>
<li><code>rf_s_q1</code></li>
<li><code>rf_s_q2</code></li>
<li><code>rf_w_q1</code></li>
<li><code>rf_w_q2</code></li>
</ul></li>
<li>Ria de Alvor
<ul>
<li><code>ra_s_q1</code></li>
<li><code>ra_s_q2</code></li>
<li><code>ra_w_q1</code></li>
<li><code>ra_w_q2</code></li>
</ul></li>
<li>Quadrats
<ul>
<li><code>quadrats01</code></li>
</ul></li>
</ul>
</section>
<section id="add-missing-columns" class="level2">
<h2 class="anchored" data-anchor-id="add-missing-columns">Add missing columns</h2>
<p>Currently, the fiddler crabs data is missing three variables:</p>
<ul>
<li><code>region</code></li>
<li><code>season</code></li>
<li><code>quadrat</code></li>
</ul>
<p>These variables were surreptitiously present in the names of the CSV files and in the name of the XLSX and included sheets.</p>
<blockquote class="blockquote">
<p>An an example, the file <code>rf_s_q1.csv</code>, whose data has been read into <code>rf_s_q1</code>, indicates in its name that crab sampling was performed in Ria Formosa (<code>"rf"</code>), in the Summer (<code>"s"</code>), in quadrat 1 (<code>"q1"</code>).</p>
</blockquote>
<section id="exercise-2.1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.1">Exercise 2.1</h3>
<p>Use the function <code>dplyr::mutate()</code> to add the three missing columns, and respective values, to each of the eight data frames:</p>
<ul>
<li>Ria Formosa
<ul>
<li><code>rf_s_q1</code></li>
<li><code>rf_s_q2</code></li>
<li><code>rf_w_q1</code></li>
<li><code>rf_w_q2</code></li>
</ul></li>
<li>Ria de Alvor
<ul>
<li><code>ra_s_q1</code></li>
<li><code>ra_s_q2</code></li>
<li><code>ra_w_q1</code></li>
<li><code>ra_w_q2</code></li>
</ul></li>
</ul>
<p>Here is an example for the data set <code>rf_s_q1</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the columns `region`, `season` and `quadrat`.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>rf_s_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_s_q1, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the result.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(rf_s_q1_01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,243
Columns: 15
$ cl        &lt;dbl&gt; 21, 21, 15, 21, 19, 17, 19, 14, 19, 19, 17, 20, 22, 15, 17, …
$ lcl       &lt;dbl&gt; 16, 13, 9, 16, 8, 7, 14, 13, 10, 12, 8, 16, 13, 9, 8, 19, 13…
$ fw        &lt;dbl&gt; 15, 16, 10, 19, 14, 15, 15, 8, 11, 19, 8, 18, 15, 11, 13, 15…
$ species   &lt;chr&gt; "A. farensis", "A. farensis", "A. farensis", "A. farensis", …
$ longitude &lt;dbl&gt; -8.01873, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ is_gravid &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE,…
$ rcl       &lt;dbl&gt; 10, 15, 5, 14, 7, 6, 9, 5, 10, 12, 13, 15, 11, 10, 6, 16, 12…
$ stage     &lt;chr&gt; "juvenile", "juvenile", "juvenile", "juvenile", "juvenile", …
$ sex       &lt;chr&gt; "?", "?", "female", "male or female", "female", "female", "f…
$ id        &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
$ cw        &lt;dbl&gt; 27, 27, 19, 26, 24, 22, 25, 18, 24, 24, 21, 25, 27, 19, 22, …
$ latitude  &lt;dbl&gt; 37.02606, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ region    &lt;chr&gt; "Ria Formosa", "Ria Formosa", "Ria Formosa", "Ria Formosa", …
$ season    &lt;chr&gt; "summer", "summer", "summer", "summer", "summer", "summer", …
$ quadrat   &lt;chr&gt; "q1", "q1", "q1", "q1", "q1", "q1", "q1", "q1", "q1", "q1", …</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Solution to Exercise 2.1</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria Formosa data sets</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>rf_s_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_s_q1, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>rf_s_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_s_q2, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>rf_w_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_w_q1, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>rf_w_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_w_q2, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria de Alvor data sets</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>ra_s_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_s_q1, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>ra_s_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_s_q2, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>ra_w_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_w_q1, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>ra_w_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_w_q2, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="make-variable-column-names-consistent-across-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="make-variable-column-names-consistent-across-data-sets">Make variable (column) names consistent across data sets</h2>
<p>Okay, now that we have all variables in our data sets, we will need to bind all data sets into one. But before we do that we will need to make sure that the variables (i.e.&nbsp;columns) across the eight data sets are all named in the same way. Otherwise, the step of combining the data sets will be cumbersome. We want it to be smooth. You’ll see in a bit what we mean.</p>
<p>We can tell you that there are discrepancies between the data sets coming from Ria Formosa and Ria de Alvor. This is because the two teams of marine biologists had different ideas on how to name two of the variables.</p>
<p>Also, the two teams had abbreviated the name of the morphological variables, and we find them hard to read, so we will rename them to new names as indicated in this table:</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Current name</th>
<th>New name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>cw</code></td>
<td><code>carapace_width</code></td>
<td>Carapace width</td>
</tr>
<tr class="even">
<td><code>cl</code></td>
<td><code>carapace_length</code></td>
<td>Carapace length</td>
</tr>
<tr class="odd">
<td><code>fw</code></td>
<td><code>front_width</code></td>
<td>Front width (distance between the crab eye stalks)</td>
</tr>
<tr class="even">
<td><code>lcl</code></td>
<td><code>left_claw_length</code></td>
<td>Left claw length</td>
</tr>
<tr class="odd">
<td><code>rcl</code></td>
<td><code>right_claw_length</code></td>
<td>Right claw length</td>
</tr>
</tbody>
</table>
<section id="exercise-2.2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.2">Exercise 2.2</h3>
<ul>
<li>Identify the two columns that have slightly different names between the Ria Formosa and the Ria de Alvor data sets.</li>
<li>Rename those two columns in the Ria de Alvor data sets (<code>ra_s_q1_01</code>, <code>ra_s_q2_01</code>, <code>ra_w_q1_01</code> and <code>ra_w_q2_01</code>) to match the names used in Ria Formosa.</li>
<li>Rename the abbreviated column names to new, more explicit, names, as indicated in the table above. Do this for all data sets.</li>
<li>Name these new data sets as: <code>rf_s_q1_02</code>, <code>rf_s_q2_02</code>, etc. and <code>ra_s_q1_02</code>, <code>ra_s_q2_02</code>, etc..</li>
</ul>
<p>Use the function <code>dplyr::rename()</code> for renaming. Here is an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-overflow-wrap code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rf_s_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_s_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(rf_s_q1_02)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,243
Columns: 15
$ carapace_length   &lt;dbl&gt; 21, 21, 15, 21, 19, 17, 19, 14, 19, 19, 17, 20, 22, …
$ left_claw_length  &lt;dbl&gt; 16, 13, 9, 16, 8, 7, 14, 13, 10, 12, 8, 16, 13, 9, 8…
$ front_width       &lt;dbl&gt; 15, 16, 10, 19, 14, 15, 15, 8, 11, 19, 8, 18, 15, 11…
$ species           &lt;chr&gt; "A. farensis", "A. farensis", "A. farensis", "A. far…
$ longitude         &lt;dbl&gt; -8.01873, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ is_gravid         &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALS…
$ right_claw_length &lt;dbl&gt; 10, 15, 5, 14, 7, 6, 9, 5, 10, 12, 13, 15, 11, 10, 6…
$ stage             &lt;chr&gt; "juvenile", "juvenile", "juvenile", "juvenile", "juv…
$ sex               &lt;chr&gt; "?", "?", "female", "male or female", "female", "fem…
$ id                &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…
$ carapace_width    &lt;dbl&gt; 27, 27, 19, 26, 24, 22, 25, 18, 24, 24, 21, 25, 27, …
$ latitude          &lt;dbl&gt; 37.02606, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ region            &lt;chr&gt; "Ria Formosa", "Ria Formosa", "Ria Formosa", "Ria Fo…
$ season            &lt;chr&gt; "summer", "summer", "summer", "summer", "summer", "s…
$ quadrat           &lt;chr&gt; "q1", "q1", "q1", "q1", "q1", "q1", "q1", "q1", "q1"…</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Solution to Exercise 2.2</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What column names are there in Ria de Alvor and not in Ria Formosa?</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">colnames</span>(ra_s_q1_01), <span class="fu">colnames</span>(rf_s_q1_01))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># And now the reverse question.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">colnames</span>(rf_s_q1_01), <span class="fu">colnames</span>(ra_s_q1_01))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># So it seems Ria de Alvor data sets have named the `species` column as</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># `species_name`, and `is_gravid?` contains a question mark. </span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let us fix by mapping:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  - `species_name` to `species`</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  - `is_gravid?` to `is_gravid`</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># And also, do not forget to map the abbreviated column names to their full</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># names.</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Note how the mapping of the names is indicated in `rename()`:</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># New names go in the left hand side of the equal sign and old names in</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># the right hand side.</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria Formosa data sets</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>rf_s_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_s_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>rf_s_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_s_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>rf_w_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_w_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>rf_w_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_w_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria de Alvor data sets</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>ra_s_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_s_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>ra_s_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_s_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>ra_w_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_w_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>ra_w_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_w_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="combining-the-crabs-data-sets-into-one" class="level2">
<h2 class="anchored" data-anchor-id="combining-the-crabs-data-sets-into-one">Combining the crabs data sets into one</h2>
<p>Now we will combine all the eight data sets into one single data frame. To do that we use the function <code>dplyr::bind_rows()</code>. And although the columns are not by the same order in all data sets, <code>bind_rows()</code> is smart enough to match each column of one data set to that of another. It does this by using the column names. And that is why it was so important harmonise the column names across data sets.</p>
<section id="exercise-2.3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.3">Exercise 2.3</h3>
<p>Bind all the eight data sets into one named <code>crabs01</code>. Note the number of rows and columns of this new data set.</p>
<div class="cell">
<details>
<summary>Solution to Exercise 2.3</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>crabs01 <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    rf_s_q1_02,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    rf_s_q2_02,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    rf_w_q1_02,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    rf_w_q2_02,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ra_s_q1_02,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    ra_s_q2_02,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    ra_w_q1_02,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ra_w_q2_02</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is how the <code>crabs01</code> should look like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>crabs01</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,326 × 15
   carapace_…¹ left_…² front…³ species longi…⁴ is_gr…⁵ right…⁶ stage sex      id
         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;lgl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
 1          21      16      15 A. far…   -8.02 FALSE        10 juve… ?         1
 2          21      13      16 A. far…   NA    FALSE        15 juve… ?         2
 3          15       9      10 A. far…   NA    TRUE          5 juve… fema…     3
 4          21      16      19 A. far…   NA    FALSE        14 juve… male…     4
 5          19       8      14 A. far…   NA    FALSE         7 juve… fema…     5
 6          17       7      15 A. far…   NA    FALSE         6 juve… fema…     6
 7          19      14      15 A. far…   NA    FALSE         9 juve… fema…     7
 8          14      13       8 A. far…   NA    FALSE         5 juve… fema…     8
 9          19      10      11 A. far…   NA    TRUE         10 juve… fema…     9
10          19      12      19 A. far…   NA    FALSE        12 juve… fema…    10
# … with 7,316 more rows, 5 more variables: carapace_width &lt;dbl&gt;,
#   latitude &lt;dbl&gt;, region &lt;chr&gt;, season &lt;chr&gt;, quadrat &lt;chr&gt;, and abbreviated
#   variable names ¹​carapace_length, ²​left_claw_length, ³​front_width,
#   ⁴​longitude, ⁵​is_gravid, ⁶​right_claw_length
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
</section>
</section>
<section id="organising-variables-columns" class="level2">
<h2 class="anchored" data-anchor-id="organising-variables-columns">Organising variables (columns)</h2>
<p>An important part of the tidying up process is getting the data in a format that is as intuitive as possible for us. With regards to the existing columns in the <code>crabs01</code> data set, there are two things we can further improve:</p>
<ul>
<li>Remove spurious columns, i.e.&nbsp;columns that do not contribute with useful information for our analysis.</li>
<li>Reorder the columns, such that we start with slow-varying columns and end with rapid-varying columns.</li>
</ul>
<section id="exercise-2.4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.4">Exercise 2.4</h3>
<ul>
<li><p>Remove the column <code>id</code> from the <code>crabs01</code> data set. This identifier was created by the the two teams to keep track of each of crab in each quadrat. But it adds no extra information for us, so we can safely drop it. You can use the function <code>dplyr::select()</code> to keep, but also, to drop columns.</p></li>
<li><p>Recognise that there are three groups of variables (columns):</p>
<ul>
<li>Contextual:
<ul>
<li><code>region</code></li>
<li><code>season</code></li>
<li><code>quadrat</code></li>
<li><code>latitude</code></li>
<li><code>longitude</code></li>
</ul></li>
<li>Demographics:
<ul>
<li><code>species</code></li>
<li><code>sex</code></li>
<li><code>stage</code></li>
<li><code>is_gravid</code></li>
</ul></li>
<li>Morphological:
<ul>
<li><code>carapace_width</code></li>
<li><code>carapace_length</code></li>
<li><code>front_width</code></li>
<li><code>left_claw_length</code></li>
<li><code>right_claw_length</code></li>
</ul></li>
</ul>
<p>And re-arrange these columns in this order. You can use the function <code>dplyr::relocate()</code>. Name the resulting data set <code>crabs02</code>.</p></li>
</ul>
<div class="cell">
<details>
<summary>Solution to Exercise 2.4</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>crabs02 <span class="ot">&lt;-</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  crabs01 <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    region,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    season,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    quadrat,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    latitude,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    longitude,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    species,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    stage,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    is_gravid,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    carapace_width,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    carapace_length,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    front_width,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    left_claw_length,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    right_claw_length</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is how the <code>crabs02</code> data set should look like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(crabs02)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,326
Columns: 14
$ region            &lt;chr&gt; "Ria Formosa", "Ria Formosa", "Ria Formosa", "Ria Fo…
$ season            &lt;chr&gt; "summer", "summer", "summer", "summer", "summer", "s…
$ quadrat           &lt;chr&gt; "q1", "q1", "q1", "q1", "q1", "q1", "q1", "q1", "q1"…
$ latitude          &lt;dbl&gt; 37.02606, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ longitude         &lt;dbl&gt; -8.01873, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ species           &lt;chr&gt; "A. farensis", "A. farensis", "A. farensis", "A. far…
$ sex               &lt;chr&gt; "?", "?", "female", "male or female", "female", "fem…
$ stage             &lt;chr&gt; "juvenile", "juvenile", "juvenile", "juvenile", "juv…
$ is_gravid         &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALS…
$ carapace_width    &lt;dbl&gt; 27, 27, 19, 26, 24, 22, 25, 18, 24, 24, 21, 25, 27, …
$ carapace_length   &lt;dbl&gt; 21, 21, 15, 21, 19, 17, 19, 14, 19, 19, 17, 20, 22, …
$ front_width       &lt;dbl&gt; 15, 16, 10, 19, 14, 15, 15, 8, 11, 19, 8, 18, 15, 11…
$ left_claw_length  &lt;dbl&gt; 16, 13, 9, 16, 8, 7, 14, 13, 10, 12, 8, 16, 13, 9, 8…
$ right_claw_length &lt;dbl&gt; 10, 15, 5, 14, 7, 6, 9, 5, 10, 12, 13, 15, 11, 10, 6…</code></pre>
</div>
</div>
</section>
</section>
<section id="filling-in-fake-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="filling-in-fake-missing-values">Filling in fake missing values</h2>
<p>Now let us start looking into the values of variables, and try to spot strange patterns or weird values.</p>
<p>Look at the columns <code>latitude</code> and <code>longitude</code>. It seems that there are a lot of missing values (<code>NA</code>) and they all seem to be associated with Ria Formosa.</p>
<p>Let us use the function <code>dplyr::count()</code> to count how many observations are there for a specific combination of variables. Let’s try the columns <code>region</code>, <code>quadrat</code>, and <code>latitude</code> and <code>longitude</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(crabs02, region, quadrat, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  region       quadrat latitude longitude     n
  &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Ria de Alvor q1          37.1     -8.60  2077
2 Ria de Alvor q2          37.1     -8.62  1618
3 Ria Formosa  q1          37.0     -8.02     2
4 Ria Formosa  q1          NA       NA     1483
5 Ria Formosa  q2          37.0     -7.99     2
6 Ria Formosa  q2          NA       NA     2144</code></pre>
</div>
</div>
<p>Let us look again at the first observations of <code>crabs02</code>. We will select a few columns, and slice a few rows for readability:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>crabs02 <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(region, quadrat, latitude, longitude) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  region      quadrat latitude longitude
  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1 Ria Formosa q1          37.0     -8.02
2 Ria Formosa q1          NA       NA   
3 Ria Formosa q1          NA       NA   
4 Ria Formosa q1          NA       NA   
5 Ria Formosa q1          NA       NA   </code></pre>
</div>
</div>
<p>It seems that the team of biologists at Ria Formosa did not record the latitude and longitude for all the observations except the first. Let’s now see if this is happening for each group of observations defined by the combination of region-quadrat:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>crabs02 <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Ria Formosa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(region, quadrat, latitude, longitude) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(region, quadrat) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   region, quadrat [2]
  region      quadrat latitude longitude
  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1 Ria Formosa q1          37.0     -8.02
2 Ria Formosa q1          NA       NA   
3 Ria Formosa q1          NA       NA   
4 Ria Formosa q2          37.0     -7.99
5 Ria Formosa q2          NA       NA   
6 Ria Formosa q2          NA       NA   </code></pre>
</div>
</div>
<p>So, these are not truly missing values. These are just values that are absent because the team decided not to record them as they are all the same until the quadrat changes. To fix this, we will need to fill in the values.</p>
<section id="exercise-2.5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.5">Exercise 2.5</h3>
<p>Use the function <code>tidyr::fill()</code> to fill in the values. Look at the documentation of this function or in the <code>{tidyr}</code> cheatsheet for how to use it.</p>
<div class="cell">
<details>
<summary>Solution to Exercise 2.5</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>crabs03 <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">fill</span>(<span class="at">data =</span> crabs02, latitude, longitude, <span class="at">.direction =</span> <span class="st">"down"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="recode-na-aliases" class="level2">
<h2 class="anchored" data-anchor-id="recode-na-aliases">Recode <code>NA</code> aliases</h2>
<p>Sometimes the values used to represent missing values may take many different forms. Take a close look at the column <code>sex</code>, and check if there are any other values than <code>"female"</code> or <code>"male"</code>.</p>
<section id="exercise-2.6" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.6">Exercise 2.6</h3>
<p>Detect <code>NA</code> aliases used by the researchers to mean missingness or uncertainty regarding the sex of the crabs, and recode them to R’s appropriate value, i.e.&nbsp;the <code>NA</code> value.</p>
<blockquote class="blockquote">
<p>Tip: use the <code>unique(crabs03$sex)</code> to see all unique values in that column. Then use a combination of <code>dplyr::mutate()</code>, <code>dplyr::if_else()</code> and the operator <code>%in%</code> to re-create the <code>sex</code> column with all missing values recoded to <code>NA</code>.</p>
</blockquote>
<div class="cell">
<details>
<summary>Solution to Exercise 2.6</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These `sex_na_aliases` were inferred after running `unique(crabs03$sex)`</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sex_na_aliases <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"?"</span>, <span class="st">"male or female"</span>, <span class="st">"-"</span>, <span class="st">" "</span>, <span class="st">"N/R"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>crabs04 <span class="ot">&lt;-</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  crabs03 <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">if_else</span>(sex <span class="sc">%in%</span> sex_na_aliases, <span class="cn">NA_character_</span>, sex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compare the values in the <code>sex</code> column before and after the recoding:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Before the recoding</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(crabs03<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "?"              "female"         "male or female" NA              
[5] "-"              "N/R"            "male"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After the recoding</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(crabs04<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA       "female" "male"  </code></pre>
</div>
</div>
</section>
</section>
<section id="general-recoding-of-values" class="level2">
<h2 class="anchored" data-anchor-id="general-recoding-of-values">General recoding of values</h2>
<p>As it turns out, the differences between the data sets generated at Ria Formosa and at Ria de Alvor are not exhausted yet… It seems that the variables <code>species</code> and <code>stage</code> are also not agreeing between the two Rias. Let us use <code>dplyr::count()</code> to see that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(crabs04, region, species, stage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
   region       species           stage           n
   &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt;       &lt;int&gt;
 1 Ria de Alvor Afruca farensis   a             464
 2 Ria de Alvor Afruca farensis   j             130
 3 Ria de Alvor Afruca farensis   p             130
 4 Ria de Alvor Afruca farensis   s             346
 5 Ria de Alvor Uca olhanensis    a             641
 6 Ria de Alvor Uca olhanensis    j             228
 7 Ria de Alvor Uca olhanensis    p             252
 8 Ria de Alvor Uca olhanensis    s             438
 9 Ria de Alvor Ucides alvorensis a             466
10 Ria de Alvor Ucides alvorensis j             128
11 Ria de Alvor Ucides alvorensis p             128
12 Ria de Alvor Ucides alvorensis s             344
13 Ria Formosa  A. farensis       adult         624
14 Ria Formosa  A. farensis       juvenile      178
15 Ria Formosa  A. farensis       pre_puberty   178
16 Ria Formosa  A. farensis       sub_adult     470
17 Ria Formosa  U. olhanensis     adult         881
18 Ria Formosa  U. olhanensis     juvenile      330
19 Ria Formosa  U. olhanensis     pre_puberty   354
20 Ria Formosa  U. olhanensis     sub_adult     616</code></pre>
</div>
</div>
<p>The team at Ria de Alvor abbreviated the names of the developmental stages, and the team at Ria Formosa seems to have abbreviated the species names. This problematic, we need to recode them.</p>
<section id="exercise-2.7" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.7">Exercise 2.7</h3>
<p>Let us convert everything to full names:</p>
<table class="table">
<thead>
<tr class="header">
<th>Old value</th>
<th>New value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>j</code></td>
<td><code>juvenile</code></td>
</tr>
<tr class="even">
<td><code>p</code></td>
<td><code>pre_puberty</code></td>
</tr>
<tr class="odd">
<td><code>s</code></td>
<td><code>sub_adult</code></td>
</tr>
<tr class="even">
<td><code>a</code></td>
<td><code>adult</code></td>
</tr>
<tr class="odd">
<td><code>A. farensis</code></td>
<td><code>Afruca farensis</code></td>
</tr>
<tr class="even">
<td><code>U. olhanensis</code></td>
<td><code>Uca olhanensis</code></td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p>A combination of <code>dplyr::mutate()</code> and <code>dplyr::recode()</code> will be helpful.</p>
</blockquote>
<div class="cell">
<details>
<summary>Solution to Exercise 2.7</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>crabs05 <span class="ot">&lt;-</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  crabs04 <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">species =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>      species,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">A. farensis</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Afruca farensis"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">U. olhanensis</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Uca olhanensis"</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>      stage,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">j</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"juvenile"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">p</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"pre_puberty"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">s</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"sub_adult"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">a</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"adult"</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">quadrat =</span> <span class="fu">substr</span>(quadrat, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The new data set should now show:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(crabs05, region, species, stage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
   region       species           stage           n
   &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt;       &lt;int&gt;
 1 Ria de Alvor Afruca farensis   adult         464
 2 Ria de Alvor Afruca farensis   juvenile      130
 3 Ria de Alvor Afruca farensis   pre_puberty   130
 4 Ria de Alvor Afruca farensis   sub_adult     346
 5 Ria de Alvor Uca olhanensis    adult         641
 6 Ria de Alvor Uca olhanensis    juvenile      228
 7 Ria de Alvor Uca olhanensis    pre_puberty   252
 8 Ria de Alvor Uca olhanensis    sub_adult     438
 9 Ria de Alvor Ucides alvorensis adult         466
10 Ria de Alvor Ucides alvorensis juvenile      128
11 Ria de Alvor Ucides alvorensis pre_puberty   128
12 Ria de Alvor Ucides alvorensis sub_adult     344
13 Ria Formosa  Afruca farensis   adult         624
14 Ria Formosa  Afruca farensis   juvenile      178
15 Ria Formosa  Afruca farensis   pre_puberty   178
16 Ria Formosa  Afruca farensis   sub_adult     470
17 Ria Formosa  Uca olhanensis    adult         881
18 Ria Formosa  Uca olhanensis    juvenile      330
19 Ria Formosa  Uca olhanensis    pre_puberty   354
20 Ria Formosa  Uca olhanensis    sub_adult     616</code></pre>
</div>
</div>
</section>
</section>
<section id="fix-scale-of-quantitative-variables" class="level2">
<h2 class="anchored" data-anchor-id="fix-scale-of-quantitative-variables">Fix scale of quantitative variables</h2>
<p>The Ria de Alvor team recorded the morphological measurements in centimetres, whereas the Ria Formosa team recorded them in millimetres. We need to fix this.</p>
<section id="exercise-2.8" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.8">Exercise 2.8</h3>
<p>Multiply the values of the morphological variables of Ria de Alvor by 10 to transform from centimetres to millimetres, and hence harmonise them with Ria Formosa’s values.</p>
<div class="cell">
<details>
<summary>Solution to Exercise 2.8</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>crabs06 <span class="ot">&lt;-</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  crabs05 <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">carapace_width =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, carapace_width <span class="sc">*</span> <span class="dv">10</span>, carapace_width),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">carapace_length =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, carapace_length <span class="sc">*</span> <span class="dv">10</span>, carapace_length),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">front_width =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, front_width <span class="sc">*</span> <span class="dv">10</span>, front_width),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">left_claw_length =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, left_claw_length <span class="sc">*</span> <span class="dv">10</span>, left_claw_length),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">right_claw_length =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, right_claw_length <span class="sc">*</span> <span class="dv">10</span>, right_claw_length)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compare the summary statistics before and after the transformation. Here is an example with <code>carapace_width</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Before multiplication by 10</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(crabs05<span class="sc">$</span>carapace_width)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1.00    4.20   10.80   22.81   36.00  142.00 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After multiplication by 10</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(crabs06<span class="sc">$</span>carapace_width)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   9.00   26.00   40.00   43.81   56.00  142.00 </code></pre>
</div>
</div>
</section>
</section>
<section id="ensure-appropriate-variable-types" class="level2">
<h2 class="anchored" data-anchor-id="ensure-appropriate-variable-types">Ensure appropriate variable types</h2>
<p>Currently our data set <code>crabs06</code> has a range of variables whose type is <code>character</code>, i.e.&nbsp;the individual values are strings. Examples are: <code>region</code>, <code>species</code>, <code>stage</code>, etc.. These are essentially nominal (or categorical), or ordered categorical (or ordinal) variables. In R these variable types are called <code>factor</code>s.</p>
<p>Although it is possible to leave these variables as the <code>character</code> type, converting to factors has a few advantages:</p>
<ul>
<li>Memory efficiency: <code>factor</code>s take up less space than <code>character</code> variables, because they are effectively stored as integers.</li>
<li>Factors are useful when you know the set of possible values but they’re not all present in a given data set. In contrast to a character vector, when you tabulate a factor you’ll get counts of all categories, even unobserved ones.</li>
</ul>
<section id="exercise-2.9" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.9">Exercise 2.9</h3>
<p>Use a combination of <code>dplyr::mutate()</code> and <code>factor()</code> to convert the following variables to factors:</p>
<ul>
<li><code>region</code></li>
<li><code>season</code></li>
<li><code>species</code></li>
<li><code>sex</code></li>
<li><code>stage</code></li>
</ul>
<p>Also, and because we do not have an integer variable in our <code>crabs06</code> data set, make the quadrat an integer (for illustrative purposes). Tip: use <code>as.integer()</code> for that.</p>
<div class="cell">
<details>
<summary>Solution to Exercise 2.9</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>crabs07 <span class="ot">&lt;-</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  crabs06 <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">factor</span>(region),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">factor</span>(season),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">quadrat =</span> <span class="fu">as.integer</span>(quadrat),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">species =</span> <span class="fu">factor</span>(species),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>)),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage =</span> <span class="fu">factor</span>(stage, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"juvenile"</span>, <span class="st">"pre_puberty"</span>, <span class="st">"sub_adult"</span>, <span class="st">"adult"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="column-names-are-values-not-variable-names" class="level2">
<h2 class="anchored" data-anchor-id="column-names-are-values-not-variable-names">Column names are values, not variable names</h2>
<p>Remember the <code>quadrats01</code> data set about the quadrats? It’s time to update it too. Look at the column names, they’re values! Also, the first column has an automatic name <code>...1</code> because originally in the Excel file it was empty.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>quadrats01</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  ...1      `Ria Formosa-q1` `Ria Formosa-q2` `Ria de Alvor-q1` Ria de Alvor-q…¹
  &lt;chr&gt;                &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;
1 Area (m2)              250              360               260              220
# … with abbreviated variable name ¹​`Ria de Alvor-q2`</code></pre>
</div>
</div>
<p>To fix this data set we will use two fancy functions that we haven’t used yet: <code>tidyr::pivot_longer()</code> and <code>tidyr::separate()</code>.</p>
<section id="exercise-2.10" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.10">Exercise 2.10</h3>
<p>Convert the <code>quadrats01</code> data set into a tidy data set by moving the values in the column names to table elements, and create new columns to accomodate them.</p>
<div class="cell">
<details>
<summary>Solution to Exercise 2.10</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>quadrats02 <span class="ot">&lt;-</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  quadrats01 <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"region_quadrat"</span>, <span class="at">values_to =</span> <span class="st">"area"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> <span class="st">"region_quadrat"</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"region"</span>, <span class="st">"quadrat"</span>), <span class="at">sep =</span> <span class="st">"-"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-2.11" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.11">Exercise 2.11</h3>
<p>And just like we did before, convert the <code>region</code> variable to factor and <code>quadrat</code> to integer and save the result to <code>quadrats03</code>.</p>
<div class="cell">
<details>
<summary>Solution to Exercise 2.11</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>quadrats03 <span class="ot">&lt;-</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  quadrats02 <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">factor</span>(region),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">quadrat =</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(quadrat, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="multiple-observational-unit-types-in-one-table" class="level2">
<h2 class="anchored" data-anchor-id="multiple-observational-unit-types-in-one-table">Multiple observational unit types in one table</h2>
<blockquote class="blockquote">
<p>Datasets often involve values collected at multiple levels, on different types of observational units. During tidying, each type of observational unit should be stored in its own table. This is closely related to the idea of database normalisation, where each fact is expressed in only one place. It’s important because otherwise inconsistencies can arise. <a href="https://tidyr.tidyverse.org/articles/tidy-data.html#multiple-types">From <code>{tidyr}</code>vignette on multiple types</a></p>
</blockquote>
<p>There are two variables (columns) in our <code>crabs07</code> data set that characterise the quadrats, not the crabs individually. These are <code>latitude</code> and <code>longitude</code>. Yet, they’ve been recorded in the crabs data sets but belong in the quadrats data set.</p>
<section id="exercise-2.12" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.12">Exercise 2.12</h3>
<p>To fix this, we will need to get the unique latitude and longitude values for each quadrat. There is a nifty function that allow us to that: <code>dplyr::distinct()</code>. And combined with <code>dplyr::left_join()</code> will get us there…</p>
<div class="cell">
<details>
<summary>Solution to Exercise 2.12</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>quadrats_coord <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(crabs07, region, quadrat, latitude, longitude)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>quadrats04 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(quadrats03, quadrats_coord)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># And now we can drop latitude and longitude from the `crabs07` data set.</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the minus sign behind the vector of column names.</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>crabs08 <span class="ot">&lt;-</span> <span class="fu">select</span>(crabs07, <span class="sc">-</span><span class="fu">c</span>(<span class="st">"latitude"</span>, <span class="st">"longitude"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here’s how it should like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>quadrats04</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  region       quadrat  area latitude longitude
  &lt;fct&gt;          &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Ria Formosa        1   250     37.0     -8.02
2 Ria Formosa        2   360     37.0     -7.99
3 Ria de Alvor       1   260     37.1     -8.60
4 Ria de Alvor       2   220     37.1     -8.62</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>crabs08</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,326 × 12
   region     season quadrat species sex   stage is_gr…¹ carap…² carap…³ front…⁴
   &lt;fct&gt;      &lt;fct&gt;    &lt;int&gt; &lt;fct&gt;   &lt;fct&gt; &lt;ord&gt; &lt;lgl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 Ria Formo… summer       1 Afruca… &lt;NA&gt;  juve… FALSE        27      21      15
 2 Ria Formo… summer       1 Afruca… &lt;NA&gt;  juve… FALSE        27      21      16
 3 Ria Formo… summer       1 Afruca… fema… juve… TRUE         19      15      10
 4 Ria Formo… summer       1 Afruca… &lt;NA&gt;  juve… FALSE        26      21      19
 5 Ria Formo… summer       1 Afruca… fema… juve… FALSE        24      19      14
 6 Ria Formo… summer       1 Afruca… fema… juve… FALSE        22      17      15
 7 Ria Formo… summer       1 Afruca… fema… juve… FALSE        25      19      15
 8 Ria Formo… summer       1 Afruca… fema… juve… FALSE        18      14       8
 9 Ria Formo… summer       1 Afruca… fema… juve… TRUE         24      19      11
10 Ria Formo… summer       1 Afruca… fema… juve… FALSE        24      19      19
# … with 7,316 more rows, 2 more variables: left_claw_length &lt;dbl&gt;,
#   right_claw_length &lt;dbl&gt;, and abbreviated variable names ¹​is_gravid,
#   ²​carapace_width, ³​carapace_length, ⁴​front_width
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
</section>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping up</h2>
<p>Finally we will give simple names to our two data sets and save them to disk to mark this milestone of Data Tidying. These exported files will be the starting point of tomorrow’s workflow about Data Visualisation with <code>{ggplot2}</code>.</p>
<section id="exercise-2.13" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.13">Exercise 2.13</h3>
<ul>
<li>Export the <code>quadrats</code> data frame to CSV (<code>data-tidy/quadrats.csv</code>)</li>
<li>Export the <code>crabs</code> data frame to CSV (<code>data-tidy/crabs.csv</code>)</li>
</ul>
<p>Although CSV files are a good way of storing our tidy data sets and of sharing it with collaborators, they do not store information about the variables (columns) types.</p>
<p>So please export also to RDS format which is a special format that only R understands but that keeps the data exactly as we have it now, thus making it easier to read in this files and continue with our workflow about Data Visualisation tomorrow.</p>
<ul>
<li>Export the <code>quadrats</code> data frame to RDS (<code>data-tidy/quadrats.rds</code>)</li>
<li>Export the <code>crabs</code> data frame to RDS (<code>data-tidy/crabs.rds</code>)</li>
</ul>
<div class="cell">
<details>
<summary>Solution to Exercise 2.13</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign to new variables with simpler names</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>quadrats <span class="ot">&lt;-</span> quadrats04</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>crabs <span class="ot">&lt;-</span> crabs08</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Export to disk</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>data_tidy_path <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data-tidy"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(quadrats, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"quadrats.csv"</span>))</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(crabs, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"crabs.csv"</span>))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(quadrats, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"quadrats.rds"</span>))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(crabs, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"crabs.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-tidying-script" class="level2">
<h2 class="anchored" data-anchor-id="data-tidying-script">Data tidying script</h2>
<p>Here is the entire script containing all code from the exercises present in section Raw Data and Data Tidying.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw Data</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tools)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the path to the raw data</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>data_raw_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data-raw"</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># List the raw data files</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(data_raw_path)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading the four CSV files (Ria Formosa)</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>rf_s_q1 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_raw_path, <span class="st">"rf_s_q1.csv"</span>))</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>rf_s_q2 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_raw_path, <span class="st">"rf_s_q2.csv"</span>))</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>rf_w_q1 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_raw_path, <span class="st">"rf_w_q1.csv"</span>))</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>rf_w_q2 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_raw_path, <span class="st">"rf_w_q2.csv"</span>))</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading now the four sheets inside of "Ria de Alvor.xlsx"</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>ra_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_raw_path, <span class="st">"Ria de Alvor.xlsx"</span>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>ra_s_q1 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(ra_path, <span class="at">sheet =</span> <span class="st">"summer-q1"</span>)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>ra_s_q2 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(ra_path, <span class="at">sheet =</span> <span class="st">"summer-q2"</span>)</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>ra_w_q1 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(ra_path, <span class="at">sheet =</span> <span class="st">"winter-q1"</span>)</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>ra_w_q2 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(ra_path, <span class="at">sheet =</span> <span class="st">"winter-q2"</span>)</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, reading the details about the quadrats</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>quadrats01 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">file.path</span>(data_raw_path, <span class="st">"quadrats.xlsx"</span>))</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Insights gained:</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="co"># - `region` and `season` are missing variables from the data sets pertaining</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   Ria Formosa. They are implictly indicated in the name of the CSV files. The "rf" and</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   the "s" or "w", meant "summer" and "winter, respectively. So we will need</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   to add these two variables to `rf_s_q1`, `rf_s_q2`, `rf_w_q1` and `rf_w_q2`.</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a><span class="co"># - </span><span class="al">TODO</span><span class="co">: To be completed!!</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Tidying</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.1</span></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria Formosa data sets</span></span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>rf_s_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_s_q1, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>rf_s_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_s_q2, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>rf_w_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_w_q1, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>rf_w_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(rf_w_q2, <span class="at">region =</span> <span class="st">"Ria Formosa"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria de Alvor data sets</span></span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>ra_s_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_s_q1, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>ra_s_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_s_q2, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"summer"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>ra_w_q1_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_w_q1, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q1"</span>)</span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a>ra_w_q2_01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(ra_w_q2, <span class="at">region =</span> <span class="st">"Ria de Alvor"</span>, <span class="at">season =</span> <span class="st">"winter"</span>, <span class="at">quadrat =</span> <span class="st">"q2"</span>)</span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.2</span></span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a><span class="co"># What column names are there in Ria de Alvor and not in Ria Formosa?</span></span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">colnames</span>(ra_s_q1_01), <span class="fu">colnames</span>(rf_s_q1_01))</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a><span class="co"># And now the reverse question.</span></span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">colnames</span>(rf_s_q1_01), <span class="fu">colnames</span>(ra_s_q1_01))</span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a><span class="co"># So it seems Ria de Alvor data sets have named the `species` column as</span></span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a><span class="co"># `species_name`, and `is_gravid?` contains a question mark. </span></span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Let us fix by mapping:</span></span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a><span class="co">#  - `species_name` to `species`</span></span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a><span class="co">#  - `is_gravid?` to `is_gravid`</span></span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a><span class="co"># And also, do not forget to map the abbreviated column names to their full</span></span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a><span class="co"># names.</span></span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Note how the mapping of the names is indicated in `rename()`:</span></span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a><span class="co"># New names go in the left hand side of the equal sign and old names in</span></span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a><span class="co"># the right hand side.</span></span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria Formosa data sets</span></span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a>rf_s_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_s_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a>rf_s_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_s_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a>rf_w_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_w_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a>rf_w_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(rf_w_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw)</span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Ria de Alvor data sets</span></span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true" tabindex="-1"></a>ra_s_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_s_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true" tabindex="-1"></a>ra_s_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_s_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true" tabindex="-1"></a>ra_w_q1_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_w_q1_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true" tabindex="-1"></a>ra_w_q2_02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(ra_w_q2_01, <span class="at">carapace_width =</span> cw, <span class="at">carapace_length =</span> cl, <span class="at">left_claw_length =</span> lcl, <span class="at">right_claw_length =</span> rcl, <span class="at">front_width =</span> fw, <span class="at">species =</span> species_name, <span class="at">is_gravid =</span> <span class="st">`</span><span class="at">is_gravid?</span><span class="st">`</span>)</span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.3</span></span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true" tabindex="-1"></a>crabs01 <span class="ot">&lt;-</span></span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true" tabindex="-1"></a>    rf_s_q1_02,</span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true" tabindex="-1"></a>    rf_s_q2_02,</span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true" tabindex="-1"></a>    rf_w_q1_02,</span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true" tabindex="-1"></a>    rf_w_q2_02,</span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true" tabindex="-1"></a>    ra_s_q1_02,</span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true" tabindex="-1"></a>    ra_s_q2_02,</span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true" tabindex="-1"></a>    ra_w_q1_02,</span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true" tabindex="-1"></a>    ra_w_q2_02</span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.4</span></span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true" tabindex="-1"></a>crabs02 <span class="ot">&lt;-</span></span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true" tabindex="-1"></a>  crabs01 <span class="sc">%&gt;%</span></span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(</span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true" tabindex="-1"></a>    region,</span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true" tabindex="-1"></a>    season,</span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true" tabindex="-1"></a>    quadrat,</span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true" tabindex="-1"></a>    latitude,</span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true" tabindex="-1"></a>    longitude,</span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true" tabindex="-1"></a>    species,</span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true" tabindex="-1"></a>    stage,</span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true" tabindex="-1"></a>    is_gravid,</span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true" tabindex="-1"></a>    carapace_width,</span>
<span id="cb46-120"><a href="#cb46-120" aria-hidden="true" tabindex="-1"></a>    carapace_length,</span>
<span id="cb46-121"><a href="#cb46-121" aria-hidden="true" tabindex="-1"></a>    front_width,</span>
<span id="cb46-122"><a href="#cb46-122" aria-hidden="true" tabindex="-1"></a>    left_claw_length,</span>
<span id="cb46-123"><a href="#cb46-123" aria-hidden="true" tabindex="-1"></a>    right_claw_length</span>
<span id="cb46-124"><a href="#cb46-124" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-125"><a href="#cb46-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-126"><a href="#cb46-126" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.5</span></span>
<span id="cb46-127"><a href="#cb46-127" aria-hidden="true" tabindex="-1"></a>crabs03 <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">fill</span>(<span class="at">data =</span> crabs02, latitude, longitude, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb46-128"><a href="#cb46-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-129"><a href="#cb46-129" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.6</span></span>
<span id="cb46-130"><a href="#cb46-130" aria-hidden="true" tabindex="-1"></a><span class="co"># These `sex_na_aliases` were inferred after running `unique(crabs03$sex)`</span></span>
<span id="cb46-131"><a href="#cb46-131" aria-hidden="true" tabindex="-1"></a>sex_na_aliases <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"?"</span>, <span class="st">"male or female"</span>, <span class="st">"-"</span>, <span class="st">" "</span>, <span class="st">"N/R"</span>)</span>
<span id="cb46-132"><a href="#cb46-132" aria-hidden="true" tabindex="-1"></a>crabs04 <span class="ot">&lt;-</span></span>
<span id="cb46-133"><a href="#cb46-133" aria-hidden="true" tabindex="-1"></a>  crabs03 <span class="sc">%&gt;%</span></span>
<span id="cb46-134"><a href="#cb46-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">if_else</span>(sex <span class="sc">%in%</span> sex_na_aliases, <span class="cn">NA_character_</span>, sex))</span>
<span id="cb46-135"><a href="#cb46-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-136"><a href="#cb46-136" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.7</span></span>
<span id="cb46-137"><a href="#cb46-137" aria-hidden="true" tabindex="-1"></a>crabs05 <span class="ot">&lt;-</span></span>
<span id="cb46-138"><a href="#cb46-138" aria-hidden="true" tabindex="-1"></a>  crabs04 <span class="sc">%&gt;%</span></span>
<span id="cb46-139"><a href="#cb46-139" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb46-140"><a href="#cb46-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">species =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(</span>
<span id="cb46-141"><a href="#cb46-141" aria-hidden="true" tabindex="-1"></a>      species,</span>
<span id="cb46-142"><a href="#cb46-142" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">A. farensis</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Afruca farensis"</span>,</span>
<span id="cb46-143"><a href="#cb46-143" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">U. olhanensis</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Uca olhanensis"</span>),</span>
<span id="cb46-144"><a href="#cb46-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(</span>
<span id="cb46-145"><a href="#cb46-145" aria-hidden="true" tabindex="-1"></a>      stage,</span>
<span id="cb46-146"><a href="#cb46-146" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">j</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"juvenile"</span>,</span>
<span id="cb46-147"><a href="#cb46-147" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">p</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"pre_puberty"</span>,</span>
<span id="cb46-148"><a href="#cb46-148" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">s</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"sub_adult"</span>,</span>
<span id="cb46-149"><a href="#cb46-149" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">a</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"adult"</span></span>
<span id="cb46-150"><a href="#cb46-150" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb46-151"><a href="#cb46-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">quadrat =</span> <span class="fu">substr</span>(quadrat, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb46-152"><a href="#cb46-152" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-153"><a href="#cb46-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-154"><a href="#cb46-154" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.8</span></span>
<span id="cb46-155"><a href="#cb46-155" aria-hidden="true" tabindex="-1"></a>crabs06 <span class="ot">&lt;-</span></span>
<span id="cb46-156"><a href="#cb46-156" aria-hidden="true" tabindex="-1"></a>  crabs05 <span class="sc">%&gt;%</span></span>
<span id="cb46-157"><a href="#cb46-157" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb46-158"><a href="#cb46-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">carapace_width =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, carapace_width <span class="sc">*</span> <span class="dv">10</span>, carapace_width),</span>
<span id="cb46-159"><a href="#cb46-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">carapace_length =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, carapace_length <span class="sc">*</span> <span class="dv">10</span>, carapace_length),</span>
<span id="cb46-160"><a href="#cb46-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">front_width =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, front_width <span class="sc">*</span> <span class="dv">10</span>, front_width),</span>
<span id="cb46-161"><a href="#cb46-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">left_claw_length =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, left_claw_length <span class="sc">*</span> <span class="dv">10</span>, left_claw_length),</span>
<span id="cb46-162"><a href="#cb46-162" aria-hidden="true" tabindex="-1"></a>    <span class="at">right_claw_length =</span> <span class="fu">if_else</span>(region <span class="sc">==</span> <span class="st">"Ria de Alvor"</span>, right_claw_length <span class="sc">*</span> <span class="dv">10</span>, right_claw_length)</span>
<span id="cb46-163"><a href="#cb46-163" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-164"><a href="#cb46-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-165"><a href="#cb46-165" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.9</span></span>
<span id="cb46-166"><a href="#cb46-166" aria-hidden="true" tabindex="-1"></a>crabs07 <span class="ot">&lt;-</span></span>
<span id="cb46-167"><a href="#cb46-167" aria-hidden="true" tabindex="-1"></a>  crabs06 <span class="sc">%&gt;%</span></span>
<span id="cb46-168"><a href="#cb46-168" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb46-169"><a href="#cb46-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">factor</span>(region),</span>
<span id="cb46-170"><a href="#cb46-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">factor</span>(season),</span>
<span id="cb46-171"><a href="#cb46-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">quadrat =</span> <span class="fu">as.integer</span>(quadrat),</span>
<span id="cb46-172"><a href="#cb46-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">species =</span> <span class="fu">factor</span>(species),</span>
<span id="cb46-173"><a href="#cb46-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>)),</span>
<span id="cb46-174"><a href="#cb46-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage =</span> <span class="fu">factor</span>(stage, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"juvenile"</span>, <span class="st">"pre_puberty"</span>, <span class="st">"sub_adult"</span>, <span class="st">"adult"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-175"><a href="#cb46-175" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-176"><a href="#cb46-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-177"><a href="#cb46-177" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.10</span></span>
<span id="cb46-178"><a href="#cb46-178" aria-hidden="true" tabindex="-1"></a>quadrats02 <span class="ot">&lt;-</span></span>
<span id="cb46-179"><a href="#cb46-179" aria-hidden="true" tabindex="-1"></a>  quadrats01 <span class="sc">%&gt;%</span></span>
<span id="cb46-180"><a href="#cb46-180" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-181"><a href="#cb46-181" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"region_quadrat"</span>, <span class="at">values_to =</span> <span class="st">"area"</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-182"><a href="#cb46-182" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> <span class="st">"region_quadrat"</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"region"</span>, <span class="st">"quadrat"</span>), <span class="at">sep =</span> <span class="st">"-"</span>)</span>
<span id="cb46-183"><a href="#cb46-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-184"><a href="#cb46-184" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.11</span></span>
<span id="cb46-185"><a href="#cb46-185" aria-hidden="true" tabindex="-1"></a>quadrats03 <span class="ot">&lt;-</span></span>
<span id="cb46-186"><a href="#cb46-186" aria-hidden="true" tabindex="-1"></a>  quadrats02 <span class="sc">%&gt;%</span></span>
<span id="cb46-187"><a href="#cb46-187" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb46-188"><a href="#cb46-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">factor</span>(region),</span>
<span id="cb46-189"><a href="#cb46-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">quadrat =</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(quadrat, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb46-190"><a href="#cb46-190" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-191"><a href="#cb46-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-192"><a href="#cb46-192" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.12</span></span>
<span id="cb46-193"><a href="#cb46-193" aria-hidden="true" tabindex="-1"></a>quadrats_coord <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(crabs07, region, quadrat, latitude, longitude)</span>
<span id="cb46-194"><a href="#cb46-194" aria-hidden="true" tabindex="-1"></a>quadrats04 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(quadrats03, quadrats_coord)</span>
<span id="cb46-195"><a href="#cb46-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-196"><a href="#cb46-196" aria-hidden="true" tabindex="-1"></a><span class="co"># And now we can drop latitude and longitude from the `crabs07` data set.</span></span>
<span id="cb46-197"><a href="#cb46-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the minus sign behind the vector of column names.</span></span>
<span id="cb46-198"><a href="#cb46-198" aria-hidden="true" tabindex="-1"></a>crabs08 <span class="ot">&lt;-</span> <span class="fu">select</span>(crabs07, <span class="sc">-</span><span class="fu">c</span>(<span class="st">"latitude"</span>, <span class="st">"longitude"</span>))</span>
<span id="cb46-199"><a href="#cb46-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-200"><a href="#cb46-200" aria-hidden="true" tabindex="-1"></a><span class="co"># EXERCISE 2.13</span></span>
<span id="cb46-201"><a href="#cb46-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign to new variables with simpler names</span></span>
<span id="cb46-202"><a href="#cb46-202" aria-hidden="true" tabindex="-1"></a>quadrats <span class="ot">&lt;-</span> quadrats04</span>
<span id="cb46-203"><a href="#cb46-203" aria-hidden="true" tabindex="-1"></a>crabs <span class="ot">&lt;-</span> crabs08</span>
<span id="cb46-204"><a href="#cb46-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-205"><a href="#cb46-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Export to disk</span></span>
<span id="cb46-206"><a href="#cb46-206" aria-hidden="true" tabindex="-1"></a>data_tidy_path <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data-tidy"</span>)</span>
<span id="cb46-207"><a href="#cb46-207" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(quadrats, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"quadrats.csv"</span>))</span>
<span id="cb46-208"><a href="#cb46-208" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(crabs, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"crabs.csv"</span>))</span>
<span id="cb46-209"><a href="#cb46-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-210"><a href="#cb46-210" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(quadrats, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"quadrats.rds"</span>))</span>
<span id="cb46-211"><a href="#cb46-211" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(crabs, <span class="at">file =</span> <span class="fu">file.path</span>(data_tidy_path, <span class="st">"crabs.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./raw_data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Raw data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./data_visualisation.html" class="pagination-link">
        <span class="nav-page-text">Data visualisation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright 2022, Ramiro Magno &amp; Isabel Duarte</div>
  </div>
</footer>



</body></html>